-- H2 2.1.214;
SET DB_CLOSE_DELAY -1;        
;             
CREATE USER IF NOT EXISTS "SA" SALT 'a6a50ca62e69555f' HASH 'be7db4bc06b1c3861c26e12f53cd231850c28047896b0189efff0869bd9e3d92' ADMIN;         
CREATE CACHED TABLE "PUBLIC"."USERS"(
    "USER_ID" INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1 RESTART WITH 35) DEFAULT ON NULL NOT NULL,
    "USERNAME" CHARACTER VARYING(50) NOT NULL,
    "PASSWORD" CHARACTER VARYING(255) NOT NULL,
    "FULL_NAME" CHARACTER VARYING(100) NOT NULL,
    "EMAIL" CHARACTER VARYING(100),
    "USER_ROLE" CHARACTER VARYING(20) DEFAULT 'customer'
);   
ALTER TABLE "PUBLIC"."USERS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_4" PRIMARY KEY("USER_ID");   
-- 4 +/- SELECT COUNT(*) FROM PUBLIC.USERS;   
INSERT INTO "PUBLIC"."USERS" VALUES
(1, 'val', 'password', 'Godfrie Dalaida', 'admin@test.com', 'admin'),
(2, 'john', 'password123', 'John Doe', 'john@email.com', 'customer'),
(33, 'test', 'test123', 'tester999', 'test@tester.com', 'customer'),
(34, 'Godfrie', 'password', 'Godfrie', 'Godfrie@gmail.com', 'admin');
CREATE CACHED TABLE "PUBLIC"."TRANSACTIONS"(
    "TRANSACTION_ID" INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) DEFAULT ON NULL NOT NULL,
    "ACCOUNT_NUMBER" CHARACTER VARYING(50),
    "TRANSACTION_TYPE" CHARACTER VARYING(20),
    "AMOUNT" DECIMAL(15, 2) NOT NULL,
    "TRANSACTION_DATE" TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);        
ALTER TABLE "PUBLIC"."TRANSACTIONS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_F" PRIMARY KEY("TRANSACTION_ID");     
-- 0 +/- SELECT COUNT(*) FROM PUBLIC.TRANSACTIONS;            
CREATE CACHED TABLE "PUBLIC"."ACCOUNTS"(
    "ACCOUNT_NUMBER" CHARACTER VARYING(50) NOT NULL,
    "BALANCE" DECIMAL(15, 2) NOT NULL,
    "ACCOUNT_TYPE" CHARACTER VARYING(20) NOT NULL,
    "USER_ID" INTEGER
);         
ALTER TABLE "PUBLIC"."ACCOUNTS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_A" PRIMARY KEY("ACCOUNT_NUMBER");         
-- 3 +/- SELECT COUNT(*) FROM PUBLIC.ACCOUNTS;
INSERT INTO "PUBLIC"."ACCOUNTS" VALUES
('CHK123', 1000.00, 'checking', NULL),
('SAV456', 7000.00, 'savings', NULL),
('SAV024', 5000.00, 'savings', NULL);  
ALTER TABLE "PUBLIC"."TRANSACTIONS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_FE" CHECK("TRANSACTION_TYPE" IN('deposit', 'withdrawal', 'transfer')) NOCHECK;        
ALTER TABLE "PUBLIC"."ACCOUNTS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_AF" CHECK("ACCOUNT_TYPE" IN('checking', 'savings')) NOCHECK;              
ALTER TABLE "PUBLIC"."USERS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_4D" UNIQUE("USERNAME");      
ALTER TABLE "PUBLIC"."USERS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_4D4" UNIQUE("EMAIL");        
ALTER TABLE "PUBLIC"."ACCOUNTS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_AF4" FOREIGN KEY("USER_ID") REFERENCES "PUBLIC"."USERS"("USER_ID") ON DELETE CASCADE NOCHECK;             
ALTER TABLE "PUBLIC"."TRANSACTIONS" ADD CONSTRAINT "PUBLIC"."CONSTRAINT_FE9" FOREIGN KEY("ACCOUNT_NUMBER") REFERENCES "PUBLIC"."ACCOUNTS"("ACCOUNT_NUMBER") ON DELETE CASCADE NOCHECK;        
ALTER TABLE "PUBLIC"."ACCOUNTS" ADD CONSTRAINT "PUBLIC"."FK_USER_ID" FOREIGN KEY("USER_ID") REFERENCES "PUBLIC"."USERS"("USER_ID") ON DELETE CASCADE NOCHECK; 
